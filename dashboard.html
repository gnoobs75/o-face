<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>≈ç-face</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0a0a0f;
            --bg-card: rgba(255, 255, 255, 0.03);
            --bg-glass: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.08);
            --border-light: rgba(255, 255, 255, 0.12);
            --accent: #C52638;
            --accent-glow: rgba(197, 38, 56, 0.4);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.6);
            --text-muted: rgba(255, 255, 255, 0.35);
            --drawer-width: 280px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            background: var(--bg-dark);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            display: flex;
            flex-direction: column;
        }

        /* Animated background */
        .bg-gradient {
            position: fixed;
            inset: 0;
            z-index: -1;
            overflow: hidden;
        }

        .bg-gradient::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(197, 38, 56, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(56, 38, 197, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(38, 197, 156, 0.05) 0%, transparent 50%);
            animation: bgPulse 20s ease-in-out infinite;
        }

        @keyframes bgPulse {
            0%, 100% { transform: translate(0, 0) scale(1); opacity: 1; }
            50% { transform: translate(-5%, -5%) scale(1.1); opacity: 0.8; }
        }

        /* Floating particles */
        .particles {
            position: fixed;
            inset: 0;
            z-index: -1;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: float linear infinite;
        }

        @keyframes float {
            0% { transform: translateY(100vh) scale(0); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100vh) scale(1); opacity: 0; }
        }

        /* Stock Ticker */
        .stock-ticker {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 28px;
            background: linear-gradient(180deg, #1a1a20, #0f0f14);
            border-bottom: 1px solid var(--border);
            z-index: 1001;
            overflow: hidden;
            display: none;
        }
        .stock-ticker.active {
            display: block;
        }
        body.stonks-active .nav-ribbon {
            top: 28px;
        }
        body.stonks-active .left-drawer {
            top: 84px;
        }
        body.stonks-active .main-content {
            padding-top: 84px;
        }
        .ticker-content {
            display: flex;
            align-items: center;
            height: 100%;
            white-space: nowrap;
            animation: tickerScroll 30s linear infinite;
        }
        @keyframes tickerScroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        .ticker-item {
            display: inline-flex;
            align-items: center;
            padding: 0 20px;
            font-size: 12px;
            font-family: 'Share Tech Mono', monospace;
        }
        .ticker-symbol {
            color: var(--text-primary);
            font-weight: 600;
            margin-right: 8px;
        }
        .ticker-price {
            color: var(--text-secondary);
            margin-right: 6px;
        }
        .ticker-change {
            font-weight: 600;
        }
        .ticker-change.up { color: #00ff88; }
        .ticker-change.down { color: #ff4444; }
        .ticker-separator {
            color: var(--text-muted);
            margin: 0 10px;
        }

        /* Glass Nav Bar */
        .nav-ribbon {
            height: 56px;
            background: rgba(20, 20, 28, 0.98);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            -webkit-app-region: drag;
            position: relative;
            z-index: 100;
        }

        .nav-ribbon::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, rgba(255,255,255,0.05) 0%, transparent 100%);
            pointer-events: none;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 6px;
            -webkit-app-region: no-drag;
        }

        .nav-brand {
            font-weight: 700;
            font-size: 18px;
            color: var(--text-primary);
            padding: 0 16px 0 8px;
            -webkit-app-region: drag;
            letter-spacing: -0.5px;
        }

        .nav-brand span {
            color: var(--accent);
        }

        /* Drawer toggle button */
        .drawer-toggle {
            width: 40px;
            height: 40px;
            border: 1px solid var(--border);
            background: var(--bg-glass);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            transition: all 0.3s;
            -webkit-app-region: no-drag;
        }

        .drawer-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--border-light);
        }

        .drawer-toggle span {
            width: 18px;
            height: 2px;
            background: var(--text-secondary);
            border-radius: 1px;
            transition: all 0.3s;
        }

        .drawer-toggle.active span:nth-child(1) {
            transform: rotate(45deg) translate(4px, 4px);
        }

        .drawer-toggle.active span:nth-child(2) {
            opacity: 0;
        }

        .drawer-toggle.active span:nth-child(3) {
            transform: rotate(-45deg) translate(4px, -4px);
        }

        .nav-btn {
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 500;
            background: transparent;
            border: 1px solid transparent;
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: inherit;
            -webkit-app-region: no-drag;
            position: relative;
            overflow: hidden;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%);
            opacity: 0;
            transition: opacity 0.2s;
        }

        .nav-btn:hover::before { opacity: 1; }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.08);
            color: var(--text-primary);
            border-color: var(--border-light);
            transform: translateY(-1px);
        }

        .nav-btn:active { transform: translateY(0) scale(0.98); }

        .nav-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            box-shadow: 0 4px 20px var(--accent-glow), inset 0 1px 0 rgba(255,255,255,0.2);
        }

        /* Page-specific button accents */
        .nav-btn.ronin-btn:not(.active):hover { border-color: #ff00ff40; box-shadow: 0 0 20px rgba(255,0,255,0.1); background: linear-gradient(135deg, rgba(255,0,255,0.1), rgba(0,255,255,0.1)); }
        .nav-btn.kabuki-btn:not(.active):hover { border-color: #9775fa40; box-shadow: 0 0 20px rgba(151,117,250,0.1); }
        .nav-btn.meme-btn:not(.active):hover { border-color: #ffa94d40; box-shadow: 0 0 20px rgba(255,169,77,0.1); }
        .nav-btn.arcade-btn:not(.active):hover { border-color: #51cf6640; box-shadow: 0 0 20px rgba(81,207,102,0.1); }

        /* Window controls */
        .nav-right {
            display: flex;
            -webkit-app-region: no-drag;
        }

        .window-btn {
            width: 46px;
            height: 38px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.15s;
            border-radius: 6px;
        }

        .window-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .window-btn.close:hover {
            background: #e81123;
            color: white;
        }

        /* ============================================
           LEFT DRAWER
           ============================================ */
        .drawer-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 150;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .drawer-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .left-drawer {
            position: fixed;
            top: 56px;
            left: 0;
            bottom: 0;
            width: var(--drawer-width);
            background: #0f0f14;
            border-right: 1px solid var(--border);
            z-index: 200;
            transform: translateX(-100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .left-drawer.open {
            transform: translateX(0);
        }

        .drawer-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .drawer-section {
            margin-bottom: 25px;
        }

        .drawer-section-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
        }

        /* Profile Section */
        .profile-card {
            background: var(--bg-glass);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .profile-avatar {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--accent), #ff6b6b);
            border-radius: 50%;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: 0 4px 20px var(--accent-glow);
        }

        .profile-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .profile-role {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Drawer Items */
        .drawer-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-secondary);
            border: 1px solid transparent;
        }

        .drawer-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            border-color: var(--border);
        }

        .drawer-item.active {
            background: var(--accent);
            color: white;
        }

        .drawer-item-icon {
            font-size: 18px;
            width: 24px;
            text-align: center;
        }

        .drawer-item-label {
            font-size: 14px;
            font-weight: 500;
        }

        .drawer-item-badge {
            margin-left: auto;
            background: var(--accent);
            color: white;
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 600;
        }

        /* Favorites Section */
        .fav-section {
            margin-bottom: 12px;
        }
        .fav-section-title {
            font-size: 11px;
            color: var(--text-muted);
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .fav-section-title .count {
            background: var(--bg-glass);
            padding: 1px 6px;
            border-radius: 8px;
            font-size: 10px;
        }
        .fav-slider-wrapper {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .fav-slider-arrow {
            width: 20px;
            height: 50px;
            background: var(--bg-glass);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        .fav-slider-arrow:hover {
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
        }
        .fav-slider {
            flex: 1;
            overflow-x: auto;
            scroll-behavior: smooth;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .fav-slider::-webkit-scrollbar { display: none; }
        .favorites-grid {
            display: flex;
            gap: 6px;
            padding: 2px;
        }
        .favorite-item {
            width: 50px;
            height: 50px;
            flex-shrink: 0;
            background: var(--bg-glass);
            border: 1px solid var(--border);
            border-radius: 6px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s;
        }
        .favorite-item:hover {
            border-color: var(--accent);
            transform: scale(1.1);
        }
        .favorite-item.copied {
            animation: flashCopied 0.5s ease-out;
        }
        @keyframes flashCopied {
            0%, 100% { box-shadow: none; }
            50% { box-shadow: 0 0 20px #0f0, inset 0 0 20px rgba(0,255,0,0.3); border-color: #0f0; }
        }
        .favorite-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .favorites-empty {
            text-align: center;
            padding: 20px;
            color: var(--text-muted);
            font-size: 13px;
        }
        .favorites-empty-icon {
            font-size: 32px;
            margin-bottom: 8px;
            opacity: 0.5;
        }
        .fav-view-all {
            margin-top: 8px;
            text-align: center;
        }
        .fav-view-all-btn {
            background: var(--bg-glass);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 6px 16px;
            border-radius: 6px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .fav-view-all-btn:hover {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        /* Main content area */
        .main-wrapper {
            flex: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }

        .dashboard-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Dashboard home view */
        #dashboardView {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            background: var(--bg-dark);
            min-height: 200px;
        }

        #introVideo {
            max-width: 85%;
            max-height: 75%;
            object-fit: contain;
            cursor: pointer;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        #introVideo:hover {
            transform: scale(1.02);
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.6);
        }

        .skip-hint {
            position: absolute;
            bottom: 40px;
            color: var(--text-muted);
            font-size: 13px;
            opacity: 0;
            transition: all 0.3s;
            padding: 8px 16px;
            background: var(--bg-glass);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid var(--border);
        }

        #dashboardView:hover .skip-hint {
            opacity: 1;
            transform: translateY(-5px);
        }

        /* Content iframe */
        #contentFrame {
            display: none;
            flex: 1;
            width: 100%;
            border: none;
            background: transparent;
            opacity: 0;
            transition: opacity 0.4s ease-out;
        }

        #contentFrame.loaded {
            opacity: 1;
        }

        /* Loading overlay */
        .loading-overlay {
            position: absolute;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: var(--bg-dark);
            z-index: 50;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loader {
            width: 48px;
            height: 48px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Page transition */
        .page-transition {
            position: fixed;
            inset: 0;
            background: var(--bg-dark);
            z-index: 300;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .page-transition.active {
            opacity: 1;
        }

        /* Preferences modal styles */
        .pref-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }

        .pref-item:last-child {
            border-bottom: none;
        }

        .pref-label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .pref-toggle {
            width: 44px;
            height: 24px;
            background: var(--bg-glass);
            border: 1px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            position: relative;
            transition: all 0.2s;
        }

        .pref-toggle.active {
            background: var(--accent);
            border-color: var(--accent);
        }

        .pref-toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .pref-toggle.active::after {
            left: 22px;
        }

        /* Mini Player in Drawer */
        .mini-player {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.6);
            border-top: 1px solid var(--border);
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .mini-player-art {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent), #ff6b6b);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .mini-player-info {
            flex: 1;
            min-width: 0;
            overflow: hidden;
        }

        .mini-player-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .mini-player-artist {
            font-size: 10px;
            color: var(--text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .mini-player-controls {
            display: flex;
            gap: 4px;
        }

        .mini-player-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s;
        }

        .mini-player-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .mini-player-btn.play-btn {
            width: 36px;
            height: 36px;
            background: var(--accent);
            color: white;
        }

        .mini-player-btn.play-btn:hover {
            background: var(--accent);
            transform: scale(1.05);
            box-shadow: 0 0 15px var(--accent-glow);
        }

        .mini-player-progress {
            position: absolute;
            top: 0;
            left: 0;
            height: 2px;
            background: var(--accent);
            width: 0%;
            transition: width 0.3s linear;
        }

        /* Adjust drawer content padding for mini player */
        .drawer-content {
            padding-bottom: 80px;
        }

        /* d≈çice Floating Panel (draggable) */
        .dice-panel {
            position: fixed;
            left: 70px;
            top: 80px;
            transform: scale(0);
            width: 180px;
            background: #0f0f14;
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            z-index: 300;
            display: flex;
            flex-direction: column;
            opacity: 0;
            transition: opacity 0.2s ease, transform 0.2s ease;
        }
        .dice-panel.open {
            transform: scale(1);
            opacity: 1;
        }
        .dice-panel.dragging {
            transition: none;
        }
        .dice-panel-header {
            padding: 10px 12px;
            background: #1a1a20;
            border-bottom: 1px solid var(--border);
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
            user-select: none;
        }
        .dice-panel-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }
        .dice-panel-close {
            width: 20px;
            height: 20px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 3px;
            font-size: 16px;
            line-height: 1;
        }
        .dice-panel-close:hover { background: var(--bg-input); color: var(--text-primary); }
        .dice-panel-content {
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .dice-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
        }
        .dice-type-btn {
            padding: 8px 4px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
        }
        .dice-type-btn:hover {
            border-color: var(--accent);
            color: var(--text-primary);
        }
        .dice-type-btn.selected {
            background: var(--accent);
            border-color: var(--accent);
            color: #fff;
        }
        .dice-qty-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .dice-qty-row label {
            font-size: 11px;
            color: var(--text-muted);
        }
        .dice-quantity-input {
            width: 50px;
            padding: 6px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text-primary);
            font-size: 14px;
            text-align: center;
        }
        .dice-roll-btn {
            width: 100%;
            padding: 10px;
            background: var(--accent);
            border: none;
            border-radius: 6px;
            color: #fff;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
        }
        .dice-roll-btn:hover {
            background: var(--accent-hover);
            transform: scale(1.02);
        }
        .dice-history {
            max-height: 150px;
            overflow-y: auto;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 4px;
        }
        .dice-history-item {
            padding: 6px 8px;
            border-bottom: 1px solid var(--border);
            font-size: 11px;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .dice-history-item:last-child { border-bottom: none; }
        .dice-history-item .roll-result {
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 600;
        }
        .dice-history-item.crit .roll-result { color: #ff4444; }
        .dice-history-item.nat1 .roll-result { color: #6666ff; }

        /* Fullscreen Dice Rolling Arena - Physics-based */
        .dice-arena-fullscreen {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 9998;
            pointer-events: none;
            display: none;
            perspective: 2000px;
            overflow: hidden;
        }
        .dice-arena-fullscreen.active {
            display: block;
            pointer-events: auto;
        }

        /* Physics dice container */
        .physics-die {
            position: absolute;
            transform-style: preserve-3d;
            pointer-events: none;
            will-change: transform, left, top;
        }

        .physics-die .die-inner {
            width: 70px;
            height: 70px;
            transform-style: preserve-3d;
            position: relative;
        }

        /* D6 Cube - True 3D */
        .die-inner.d6-cube {
            width: 70px;
            height: 70px;
        }
        .d6-cube .cube-face {
            position: absolute;
            width: 70px;
            height: 70px;
            background: linear-gradient(145deg, #e74c3c, #c0392b);
            border: 3px solid #ffd700;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: bold;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            box-shadow: inset 0 0 20px rgba(0,0,0,0.3);
            backface-visibility: visible;
        }
        .d6-cube .cube-front  { transform: translateZ(35px); }
        .d6-cube .cube-back   { transform: rotateY(180deg) translateZ(35px); }
        .d6-cube .cube-right  { transform: rotateY(90deg) translateZ(35px); }
        .d6-cube .cube-left   { transform: rotateY(-90deg) translateZ(35px); }
        .d6-cube .cube-top    { transform: rotateX(90deg) translateZ(35px); }
        .d6-cube .cube-bottom { transform: rotateX(-90deg) translateZ(35px); }

        /* D6 Pips */
        .pip-grid { display: grid; gap: 6px; }
        .pip-grid.pip-1 { grid-template: 1fr / 1fr; }
        .pip-grid.pip-2 { grid-template: 1fr 1fr / 1fr; }
        .pip-grid.pip-3 { grid-template: 1fr 1fr 1fr / 1fr; }
        .pip-grid.pip-4 { grid-template: 1fr 1fr / 1fr 1fr; }
        .pip-grid.pip-5 { grid-template: 1fr 1fr 1fr / 1fr 1fr 1fr; place-items: center; }
        .pip-grid.pip-6 { grid-template: 1fr 1fr 1fr / 1fr 1fr; }
        .pip {
            width: 12px;
            height: 12px;
            background: radial-gradient(circle at 30% 30%, #fff, #ddd);
            border-radius: 50%;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2), 0 1px 2px rgba(0,0,0,0.3);
        }

        /* D4 Tetrahedron */
        .die-inner.d4-tetra {
            width: 80px;
            height: 70px;
        }
        .d4-tetra .tetra-face {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 40px solid transparent;
            border-right: 40px solid transparent;
            border-bottom: 70px solid;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .d4-tetra .tetra-face span {
            position: absolute;
            top: 35px;
            font-size: 22px;
            font-weight: bold;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        .d4-tetra .face-1 { border-bottom-color: #9b59b6; transform: rotateX(19.5deg) translateZ(20px); }
        .d4-tetra .face-2 { border-bottom-color: #8e44ad; transform: rotateY(120deg) rotateX(19.5deg) translateZ(20px); }
        .d4-tetra .face-3 { border-bottom-color: #7d3c98; transform: rotateY(240deg) rotateX(19.5deg) translateZ(20px); }
        .d4-tetra .face-4 { border-bottom-color: #6c3483; transform: rotateX(-90deg) translateZ(24px); }

        /* D8 Octahedron */
        .die-inner.d8-octa {
            width: 60px;
            height: 80px;
        }
        .d8-octa .octa-face {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 30px solid transparent;
            border-right: 30px solid transparent;
            border-bottom: 50px solid;
        }
        .d8-octa .octa-face span {
            position: absolute;
            top: 25px;
            left: -8px;
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        .d8-octa .face-1 { border-bottom-color: #3498db; transform: rotateX(35deg) translateZ(22px); }
        .d8-octa .face-2 { border-bottom-color: #2980b9; transform: rotateY(90deg) rotateX(35deg) translateZ(22px); }
        .d8-octa .face-3 { border-bottom-color: #2471a3; transform: rotateY(180deg) rotateX(35deg) translateZ(22px); }
        .d8-octa .face-4 { border-bottom-color: #1f618d; transform: rotateY(270deg) rotateX(35deg) translateZ(22px); }
        .d8-octa .face-5 { border-bottom-color: #1a5276; transform: rotateX(145deg) translateZ(22px); }
        .d8-octa .face-6 { border-bottom-color: #154360; transform: rotateY(90deg) rotateX(145deg) translateZ(22px); }
        .d8-octa .face-7 { border-bottom-color: #1a5276; transform: rotateY(180deg) rotateX(145deg) translateZ(22px); }
        .d8-octa .face-8 { border-bottom-color: #1f618d; transform: rotateY(270deg) rotateX(145deg) translateZ(22px); }

        /* D10 Pentagonal Trapezohedron */
        .die-inner.d10-penta {
            width: 55px;
            height: 75px;
        }
        .d10-penta .d10-face {
            position: absolute;
            width: 30px;
            height: 45px;
            background: linear-gradient(180deg, #f39c12, #d68910);
            clip-path: polygon(50% 0%, 100% 35%, 50% 100%, 0% 35%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            color: #fff;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
            padding-top: 8px;
        }

        /* D12 Dodecahedron */
        .die-inner.d12-dodeca {
            width: 65px;
            height: 65px;
        }
        .d12-dodeca .dodeca-face {
            position: absolute;
            width: 40px;
            height: 40px;
            background: linear-gradient(145deg, #2ecc71, #27ae60);
            clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            color: #fff;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }

        /* D20 Icosahedron */
        .die-inner.d20-icosa {
            width: 70px;
            height: 80px;
        }
        .d20-icosa .icosa-face {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 25px solid transparent;
            border-right: 25px solid transparent;
            border-bottom: 43px solid;
        }
        .d20-icosa .icosa-face span {
            position: absolute;
            top: 18px;
            left: -10px;
            font-size: 14px;
            font-weight: bold;
            color: #fff;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
            width: 20px;
            text-align: center;
        }
        .d20-icosa .icosa-face:nth-child(odd) { border-bottom-color: #9b59b6; }
        .d20-icosa .icosa-face:nth-child(even) { border-bottom-color: #8e44ad; }

        /* Crit and Nat1 effects */
        .physics-die.crit .die-inner {
            filter: drop-shadow(0 0 20px #ff4444) drop-shadow(0 0 40px #ff0000);
        }
        .physics-die.crit .cube-face,
        .physics-die.crit .dodeca-face,
        .physics-die.crit .d10-face {
            background: linear-gradient(145deg, #ff4444, #cc0000) !important;
            border-color: #ffaa00 !important;
        }
        .physics-die.crit .tetra-face,
        .physics-die.crit .octa-face,
        .physics-die.crit .icosa-face {
            border-bottom-color: #ff4444 !important;
        }
        .physics-die.crit::after {
            content: 'üî•';
            position: absolute;
            font-size: 30px;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            animation: critFlame 0.4s ease-in-out infinite alternate;
            z-index: 100;
        }

        .physics-die.nat1 .die-inner {
            filter: drop-shadow(0 0 20px #4444ff) drop-shadow(0 0 40px #0000ff);
        }
        .physics-die.nat1 .cube-face,
        .physics-die.nat1 .dodeca-face {
            background: linear-gradient(145deg, #4466ff, #2244cc) !important;
        }
        .physics-die.nat1 .icosa-face {
            border-bottom-color: #4466ff !important;
        }
        .physics-die.nat1::after {
            content: 'üíÄ';
            position: absolute;
            font-size: 24px;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            animation: nat1Shake 0.2s ease-in-out infinite;
            z-index: 100;
        }

        @keyframes critFlame {
            0% { transform: translateX(-50%) scale(1) rotate(-5deg); }
            100% { transform: translateX(-50%) scale(1.3) rotate(5deg); }
        }
        @keyframes nat1Shake {
            0%, 100% { transform: translateX(-50%) rotate(-5deg); }
            50% { transform: translateX(-50%) rotate(5deg); }
        }

        /* Bounce trail effect */
        .bounce-spark {
            position: absolute;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, #ffd700, transparent);
            border-radius: 50%;
            pointer-events: none;
            animation: sparkFade 0.5s ease-out forwards;
        }
        @keyframes sparkFade {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(2); }
        }

        /* Shadow beneath dice */
        .die-shadow {
            position: absolute;
            width: 60px;
            height: 20px;
            background: radial-gradient(ellipse, rgba(0,0,0,0.4), transparent);
            border-radius: 50%;
            pointer-events: none;
        }

        /* Dice result popup */
        .dice-result-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(180deg, #2a1a0a, #1a0f05);
            border: 4px solid #ffd700;
            border-radius: 20px;
            padding: 30px 50px;
            z-index: 9999;
            text-align: center;
            font-family: 'Cinzel', serif;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.5), 0 20px 60px rgba(0,0,0,0.5);
            opacity: 0;
            transition: all 0.3s ease;
        }
        .dice-result-popup.show {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }
        .dice-result-popup .total {
            font-size: 72px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }
        .dice-result-popup .breakdown {
            font-size: 18px;
            color: #cd853f;
            margin-top: 10px;
        }
        .dice-result-popup.crit .total {
            color: #ff4444;
            text-shadow: 0 0 30px #ff0000;
        }
        .dice-result-popup.nat1 .total {
            color: #6666ff;
        }

        /* WinAmp Player Panel (draggable like dice) */
        .winamp-panel {
            position: fixed;
            left: 70px;
            top: 180px;
            width: 380px;
            background: linear-gradient(180deg, #3a3a4a, #1e1e28);
            border: 2px solid #555;
            border-radius: 8px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.1);
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            z-index: 500;
            transform: scale(0);
            opacity: 0;
            transition: opacity 0.2s ease, transform 0.2s ease;
        }
        .winamp-panel.open {
            transform: scale(1);
            opacity: 1;
        }
        .winamp-panel.dragging {
            transition: none;
        }
        .winamp-titlebar {
            height: 32px;
            background: linear-gradient(180deg, #4a4a5a, #2a2a3a);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            border-bottom: 1px solid #222;
            cursor: move;
            user-select: none;
        }
        .winamp-title {
            font-size: 12px;
            font-weight: bold;
            color: #0f0;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 10px #0f0;
        }
        .winamp-controls { display: flex; gap: 4px; }
        .winamp-ctrl-btn {
            width: 22px;
            height: 22px;
            border: 1px solid #666;
            background: linear-gradient(180deg, #4a4a5a, #2a2a3a);
            color: #aaa;
            font-size: 11px;
            cursor: pointer;
            border-radius: 3px;
        }
        .winamp-ctrl-btn:hover { background: #555; color: #fff; }
        .winamp-display {
            background: #0a1a0a;
            padding: 12px 15px;
            border: 2px inset #333;
            margin: 8px;
            border-radius: 4px;
        }
        .winamp-track-info {
            font-size: 14px;
            color: #0f0;
            white-space: nowrap;
            overflow: hidden;
            margin-bottom: 8px;
            text-shadow: 0 0 8px #0f0;
        }
        .winamp-time-row {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .winamp-time {
            font-family: 'Consolas', monospace;
            font-size: 28px;
            font-weight: bold;
            color: #0f0;
            text-shadow: 0 0 10px #0f0;
        }
        .winamp-kbps, .winamp-khz {
            font-size: 10px;
            color: #0a0;
        }
        .winamp-seek-container { padding: 0 15px 10px; }
        .winamp-seek {
            width: 100%;
            height: 12px;
            -webkit-appearance: none;
            background: #222;
            border-radius: 6px;
            cursor: pointer;
        }
        .winamp-seek::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: linear-gradient(180deg, #0f0, #080);
            border-radius: 50%;
            box-shadow: 0 0 10px #0f0;
            cursor: pointer;
        }
        .winamp-body {
            padding: 10px 15px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(180deg, #2a2a3a, #1a1a2a);
        }
        .winamp-buttons { display: flex; gap: 8px; }
        .winamp-btn {
            width: 40px;
            height: 36px;
            border: 1px solid #555;
            background: linear-gradient(180deg, #4a4a5a, #2a2a3a);
            color: #ccc;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.15s;
        }
        .winamp-btn:hover { background: #555; color: #0f0; box-shadow: 0 0 10px rgba(0,255,0,0.3); }
        .winamp-btn:active { transform: scale(0.95); }
        .winamp-volume-container {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #888;
        }
        .winamp-volume {
            width: 80px;
            height: 8px;
            -webkit-appearance: none;
            background: #222;
            border-radius: 4px;
            cursor: pointer;
        }
        .winamp-volume::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 18px;
            background: linear-gradient(180deg, #666, #333);
            border-radius: 2px;
            cursor: pointer;
        }
        .winamp-visualizer {
            height: 100px;
            background: #0a0a0f;
            margin: 0 8px 8px;
            border: 2px inset #333;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }
        .winamp-visualizer canvas { width: 100%; height: 100%; }
        .winamp-playlist {
            max-height: 120px;
            overflow-y: auto;
            background: #111;
            margin: 0 8px 8px;
            border: 2px inset #333;
            border-radius: 4px;
        }
        .winamp-playlist-item {
            padding: 8px 12px;
            font-size: 11px;
            color: #0a0;
            cursor: pointer;
            border-bottom: 1px solid #222;
            transition: all 0.15s;
            user-select: none;
        }
        .winamp-playlist-item:hover { background: #1a1a1a; color: #0f0; }
        .winamp-playlist-item:active { background: #0a3a0a; transform: scale(0.98); }
        .winamp-playlist-item.active { background: #0a2a0a; color: #0f0; font-weight: bold; }
        .winamp-footer {
            display: flex;
            background: linear-gradient(180deg, #2a2a3a, #1a1a2a);
            border-top: 1px solid #444;
        }
        .winamp-footer-btn {
            flex: 1;
            padding: 12px 8px;
            font-size: 11px;
            cursor: pointer;
            text-align: center;
            border: none;
            background: transparent;
            color: #888;
            transition: all 0.15s;
        }
        .winamp-footer-btn:hover { background: rgba(0,255,0,0.1); color: #0f0; }
        .winamp-footer-btn:not(:last-child) { border-right: 1px solid #333; }
        .winamp-footer-btn.screensaver { color: #f0a; }
        .winamp-footer-btn.screensaver:hover { background: rgba(255,0,170,0.1); }

        /* Screensaver Overlay */
        .screensaver-overlay {
            position: fixed;
            inset: 0;
            background: #000;
            z-index: 9999;
            display: none;
            cursor: none;
        }
        .screensaver-overlay.active { display: block; }
        .screensaver-overlay canvas {
            width: 100%;
            height: 100%;
        }
        .screensaver-hint {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255,255,255,0.3);
            font-size: 12px;
            pointer-events: none;
            animation: fadeHint 3s ease-out forwards;
        }
        @keyframes fadeHint {
            0%, 70% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* ==========================================
           PROPER 3D DICE GEOMETRY
           ========================================== */

        /* Container for rolling dice */
        .rolling-die-3d {
            position: absolute;
            perspective: 800px;
        }

        .die-shape {
            position: relative;
            transform-style: preserve-3d;
            animation: diceRoll3D 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        @keyframes diceRoll3D {
            0% {
                transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg) scale(0.2);
                opacity: 0;
            }
            10% { opacity: 1; }
            25% { transform: rotateX(450deg) rotateY(360deg) rotateZ(180deg) scale(1); }
            50% { transform: rotateX(720deg) rotateY(540deg) rotateZ(270deg) scale(1.1); }
            75% { transform: rotateX(900deg) rotateY(720deg) rotateZ(315deg) scale(1); }
            90% { transform: rotateX(1050deg) rotateY(840deg) rotateZ(350deg) scale(1.05); }
            100% { transform: rotateX(1080deg) rotateY(900deg) rotateZ(360deg) scale(1); }
        }

        .die-face {
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Cinzel', serif;
            font-weight: 700;
            backface-visibility: visible;
            box-sizing: border-box;
        }

        /* =========================
           D6 - CUBE (Perfect 3D)
           ========================= */
        .die-cube {
            width: 60px;
            height: 60px;
            transform-style: preserve-3d;
        }

        .die-cube .cube-face {
            width: 60px;
            height: 60px;
            background: linear-gradient(145deg, #6a2c2c, #3a1515);
            border: 2px solid #e74c3c;
            font-size: 28px;
            color: #ffcccc;
            text-shadow: 0 0 10px rgba(255, 100, 100, 0.8), 0 2px 4px rgba(0,0,0,0.5);
            box-shadow: inset 0 0 15px rgba(231, 76, 60, 0.4);
        }

        .die-cube .cube-front  { transform: translateZ(30px); }
        .die-cube .cube-back   { transform: rotateY(180deg) translateZ(30px); }
        .die-cube .cube-right  { transform: rotateY(90deg) translateZ(30px); }
        .die-cube .cube-left   { transform: rotateY(-90deg) translateZ(30px); }
        .die-cube .cube-top    { transform: rotateX(90deg) translateZ(30px); }
        .die-cube .cube-bottom { transform: rotateX(-90deg) translateZ(30px); }

        /* Pip patterns for D6 */
        .die-cube .cube-face .pip-container {
            display: grid;
            width: 44px;
            height: 44px;
            gap: 4px;
        }
        .die-cube .pip {
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, #fff, #ffcccc);
            border-radius: 50%;
            box-shadow: 0 0 4px rgba(255,255,255,0.8), inset 0 1px 2px rgba(0,0,0,0.3);
        }

        /* =========================
           D4 - TETRAHEDRON (Solid pyramid shape)
           ========================= */
        .die-tetrahedron {
            width: 60px;
            height: 52px;
            transform-style: preserve-3d;
        }

        .die-tetrahedron .tetra-main {
            position: absolute;
            width: 60px;
            height: 52px;
            background: linear-gradient(135deg, #9b59b6 0%, #6c3483 50%, #4a235a 100%);
            clip-path: polygon(50% 0%, 100% 100%, 0% 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding-top: 18px;
            font-family: 'Cinzel', serif;
            font-size: 22px;
            font-weight: 700;
            color: #e8d0f8;
            text-shadow: 0 0 10px rgba(155, 89, 182, 0.9), 0 2px 4px rgba(0,0,0,0.5);
            box-shadow:
                -2px 2px 0 #4a235a,
                -4px 4px 0 #3a1a4a,
                inset 0 -20px 30px rgba(0,0,0,0.3),
                inset 10px 0 20px rgba(255,255,255,0.1);
            border: 2px solid #8e44ad;
        }

        /* =========================
           D8 - OCTAHEDRON (Diamond shape)
           ========================= */
        .die-octahedron {
            width: 50px;
            height: 70px;
            transform-style: preserve-3d;
        }

        .die-octahedron .octa-main {
            position: absolute;
            width: 50px;
            height: 70px;
            background: linear-gradient(180deg, #3498db 0%, #2980b9 40%, #1a5276 100%);
            clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Cinzel', serif;
            font-size: 22px;
            font-weight: 700;
            color: #b8e8ff;
            text-shadow: 0 0 10px rgba(52, 152, 219, 0.9), 0 2px 4px rgba(0,0,0,0.5);
            box-shadow:
                2px 2px 0 #1a5276,
                4px 4px 0 #154360,
                inset 0 -15px 25px rgba(0,0,0,0.3),
                inset 5px 0 15px rgba(255,255,255,0.15);
            border: 2px solid #5dade2;
        }

        /* =========================
           D10 - KITE/CRYSTAL SHAPE
           ========================= */
        .die-d10-shape {
            width: 48px;
            height: 65px;
            transform-style: preserve-3d;
        }

        .die-d10-shape .d10-main {
            position: absolute;
            width: 48px;
            height: 65px;
            background: linear-gradient(180deg, #f39c12 0%, #d68910 35%, #9c640c 100%);
            clip-path: polygon(50% 0%, 95% 35%, 50% 100%, 5% 35%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding-bottom: 8px;
            font-family: 'Cinzel', serif;
            font-size: 20px;
            font-weight: 700;
            color: #fff5e0;
            text-shadow: 0 0 10px rgba(243, 156, 18, 0.9), 0 2px 4px rgba(0,0,0,0.5);
            box-shadow:
                2px 2px 0 #9c640c,
                4px 4px 0 #7d5208,
                inset 0 -12px 20px rgba(0,0,0,0.3),
                inset 5px 0 15px rgba(255,255,255,0.2);
            border: 2px solid #f5b041;
        }

        /* =========================
           D12 - PENTAGON SHAPE
           ========================= */
        .die-dodecahedron {
            width: 58px;
            height: 55px;
            transform-style: preserve-3d;
        }

        .die-dodecahedron .dodeca-main {
            position: absolute;
            width: 58px;
            height: 55px;
            background: linear-gradient(180deg, #2ecc71 0%, #27ae60 40%, #1e8449 100%);
            clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Cinzel', serif;
            font-size: 20px;
            font-weight: 700;
            color: #a9f5c5;
            text-shadow: 0 0 10px rgba(46, 204, 113, 0.9), 0 2px 4px rgba(0,0,0,0.5);
            box-shadow:
                2px 2px 0 #1e8449,
                4px 4px 0 #186a3b,
                inset 0 -15px 25px rgba(0,0,0,0.25),
                inset 5px 0 15px rgba(255,255,255,0.15);
            border: 2px solid #58d68d;
        }

        /* =========================
           D20 - ICOSAHEDRON (Hexagonal look)
           ========================= */
        .die-icosahedron {
            width: 60px;
            height: 68px;
            transform-style: preserve-3d;
        }

        .die-icosahedron .icosa-main {
            position: absolute;
            width: 60px;
            height: 68px;
            background: linear-gradient(180deg, #9b59b6 0%, #8e44ad 30%, #6c3483 70%, #4a235a 100%);
            clip-path: polygon(50% 0%, 93% 25%, 93% 75%, 50% 100%, 7% 75%, 7% 25%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Cinzel', serif;
            font-size: 24px;
            font-weight: 700;
            color: #e8d0f8;
            text-shadow: 0 0 12px rgba(155, 89, 182, 0.9), 0 2px 4px rgba(0,0,0,0.5);
            box-shadow:
                2px 2px 0 #5b2c6f,
                4px 4px 0 #4a235a,
                inset 0 -20px 30px rgba(0,0,0,0.3),
                inset 8px 0 20px rgba(255,255,255,0.1);
            border: 2px solid #af7ac5;
        }

        /* =========================
           CRIT & NAT1 EFFECTS
           ========================= */
        .die-shape.crit .cube-face {
            border-color: #ff4444 !important;
            box-shadow: 0 0 20px rgba(255, 68, 68, 0.8), 0 0 40px rgba(255, 68, 68, 0.4), inset 0 0 15px rgba(255, 68, 68, 0.4) !important;
        }

        .die-shape.crit .tetra-main,
        .die-shape.crit .octa-main,
        .die-shape.crit .d10-main,
        .die-shape.crit .dodeca-main,
        .die-shape.crit .icosa-main {
            border-color: #ff4444 !important;
            box-shadow: 0 0 25px rgba(255, 68, 68, 0.9), 0 0 50px rgba(255, 68, 68, 0.5), 2px 2px 0 #aa0000, 4px 4px 0 #880000 !important;
            color: #ffaaaa !important;
        }

        .die-shape.crit::after {
            content: 'üî•';
            position: absolute;
            font-size: 30px;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            animation: critFlame 0.5s ease-in-out infinite alternate;
            z-index: 100;
        }

        @keyframes critFlame {
            0% { transform: translateX(-50%) scale(1) rotate(-5deg); }
            100% { transform: translateX(-50%) scale(1.2) rotate(5deg); }
        }

        .die-shape.nat1 .icosa-main {
            border-color: #6688ff !important;
            box-shadow: 0 0 25px rgba(100, 100, 255, 0.9), 0 0 50px rgba(100, 100, 255, 0.5), 2px 2px 0 #4444aa, 4px 4px 0 #333388 !important;
            color: #aabbff !important;
        }

        .die-shape.nat1::after {
            content: 'üíÄ';
            position: absolute;
            font-size: 24px;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            animation: nat1Shake 0.3s ease-in-out infinite;
            z-index: 100;
        }

        @keyframes nat1Shake {
            0%, 100% { transform: translateX(-50%) rotate(-3deg); }
            50% { transform: translateX(-50%) rotate(3deg); }
        }
    </style>
</head>
<body>
    <!-- Animated background -->
    <div class="bg-gradient"></div>
    <div class="particles" id="particles"></div>

    <!-- Page transition overlay -->
    <div class="page-transition" id="pageTransition"></div>

    <!-- Drawer overlay (click to close) -->
    <div class="drawer-overlay" id="drawerOverlay" onclick="toggleDrawer()"></div>

    <!-- WinAmp Player Panel (draggable) -->
    <div class="winamp-panel" id="winampPanel">
        <div class="winamp-titlebar">
            <span class="winamp-title">Win<span style="color: var(--accent);">≈å</span>mp</span>
            <div class="winamp-controls">
                <button class="winamp-ctrl-btn" onclick="closeWinamp()" title="Close">√ó</button>
            </div>
        </div>
            <div class="winamp-display">
                <div class="winamp-track-info" id="winampTrackName">No track loaded</div>
                <div class="winamp-time-row">
                    <span class="winamp-time" id="winampTime">0:00</span>
                    <span class="winamp-kbps">320kbps</span>
                    <span class="winamp-khz">44khz</span>
                </div>
            </div>
            <div class="winamp-seek-container">
                <input type="range" class="winamp-seek" id="winampSeek" min="0" max="100" value="0" oninput="seekWinamp(this.value)">
            </div>
            <div class="winamp-body">
                <div class="winamp-buttons">
                    <button class="winamp-btn" onclick="miniPlayerPrev()" title="Previous">‚èÆ</button>
                    <button class="winamp-btn" onclick="miniPlayerToggle()" id="winampPlayBtn" title="Play">‚ñ∂</button>
                    <button class="winamp-btn" onclick="stopWinamp()" title="Stop">‚èπ</button>
                    <button class="winamp-btn" onclick="miniPlayerNext()" title="Next">‚è≠</button>
                </div>
                <div class="winamp-volume-container">
                    <span>üîä</span>
                    <input type="range" class="winamp-volume" id="winampVolume" min="0" max="100" value="70" oninput="setWinampVolume(this.value)">
                </div>
            </div>
            <div class="winamp-visualizer" id="winampVisualizer">
                <canvas id="winampCanvas"></canvas>
            </div>
            <div class="winamp-playlist" id="winampPlaylist"></div>
        <div class="winamp-footer">
            <button class="winamp-footer-btn" onclick="openAudioFiles()">+ Add</button>
            <button class="winamp-footer-btn" onclick="clearWinampPlaylist()">Clear</button>
            <button class="winamp-footer-btn screensaver" onclick="openScreensaver()">üåå Screensaver</button>
        </div>
    </div>

    <!-- Screensaver Overlay -->
    <div class="screensaver-overlay" id="screensaverOverlay" onclick="closeScreensaver()">
        <canvas id="screensaverCanvas"></canvas>
        <div class="screensaver-hint">Click anywhere to exit</div>
    </div>

    <!-- d≈çice Panel (Companion to Drawer) -->
    <div class="dice-panel" id="dicePanel">
        <div class="dice-panel-header">
            <span class="dice-panel-title">d<span style="color: var(--accent);">≈ç</span>ice</span>
            <button class="dice-panel-close" onclick="closeDicePanel()">√ó</button>
        </div>
        <div class="dice-panel-content">
            <div class="dice-selector">
                <button class="dice-type-btn" data-dice="4" onclick="selectDice(4)">d4</button>
                <button class="dice-type-btn" data-dice="6" onclick="selectDice(6)">d6</button>
                <button class="dice-type-btn" data-dice="8" onclick="selectDice(8)">d8</button>
                <button class="dice-type-btn" data-dice="10" onclick="selectDice(10)">d10</button>
                <button class="dice-type-btn" data-dice="12" onclick="selectDice(12)">d12</button>
                <button class="dice-type-btn selected" data-dice="20" onclick="selectDice(20)">d20</button>
            </div>
            <div class="dice-qty-row">
                <label>How many?</label>
                <input type="number" class="dice-quantity-input" id="diceQuantity" value="1" min="1" max="10">
            </div>
            <button class="dice-roll-btn" onclick="rollDiceFullscreen()">‚öî ROLL ‚öî</button>
            <div class="dice-history" id="diceHistory">
                <div style="color: #5a4a3a; text-align: center; padding: 20px;">Roll history appears here</div>
            </div>
        </div>
    </div>

    <!-- Fullscreen Dice Arena -->
    <div class="dice-arena-fullscreen" id="diceArenaFullscreen">
        <div class="dice-result-popup" id="diceResultPopup">
            <div class="total" id="diceResultTotal"></div>
            <div class="breakdown" id="diceResultBreakdown"></div>
        </div>
    </div>

    <!-- Left Drawer -->
    <div class="left-drawer" id="leftDrawer">
        <div class="drawer-content">
            <!-- Profile Section -->
            <div class="drawer-section">
                <div class="drawer-section-title">Profile</div>
                <div class="profile-card">
                    <div class="profile-avatar">‚öîÔ∏è</div>
                    <div class="profile-name">R≈çnin User</div>
                    <div class="profile-role">Software Warrior</div>
                </div>
            </div>

            <!-- Preferences Section -->
            <div class="drawer-section">
                <div class="drawer-section-title">Preferences</div>
                <div class="pref-item">
                    <span class="pref-label">Sound Effects</span>
                    <div class="pref-toggle active" data-pref="sound" onclick="togglePref(this, 'sound')"></div>
                </div>
                <div class="pref-item">
                    <span class="pref-label">Animations</span>
                    <div class="pref-toggle active" data-pref="animations" onclick="togglePref(this, 'animations')"></div>
                </div>
                <div class="pref-item">
                    <span class="pref-label">Auto-play Video</span>
                    <div class="pref-toggle active" data-pref="autoplay" onclick="togglePref(this, 'autoplay')"></div>
                </div>
            </div>

            <!-- Favorites Section -->
            <div class="drawer-section">
                <div class="drawer-section-title">Favorites</div>
                <div id="favoritesContainer">
                    <div class="favorites-empty">
                        <div class="favorites-empty-icon">‚≠ê</div>
                        <div>No favorites yet</div>
                        <div style="font-size: 11px; margin-top: 4px;">Save memes from memerat<span style="color: var(--accent);">≈ç</span>r</div>
                    </div>
                </div>
            </div>

            <!-- Tools Section -->
            <div class="drawer-section">
                <div class="drawer-section-title">Tools</div>
                <div class="drawer-item" onclick="openTerminal()">
                    <span class="drawer-item-icon">>_</span>
                    <span class="drawer-item-label"><span style="color: var(--accent);">≈ç</span>-term</span>
                </div>
                <div class="drawer-item" onclick="openPortmaster()">
                    <span class="drawer-item-icon">üîå</span>
                    <span class="drawer-item-label">P<span style="color: var(--accent);">≈ç</span>rtmaster</span>
                </div>
                <div class="drawer-item" onclick="openVramSpy()">
                    <span class="drawer-item-icon">üéÆ</span>
                    <span class="drawer-item-label">VRAM Sp<span style="color: var(--accent);">»≥</span></span>
                </div>
                <div class="drawer-item" onclick="navigateTo('whiteboard.html', 'whiteboard')">
                    <span class="drawer-item-icon">üìù</span>
                    <span class="drawer-item-label">Whiteb<span style="color: var(--accent);">≈ç</span>ard</span>
                </div>
                <div class="drawer-item" onclick="navigateTo('meme.html?tab=generator', 'memes')">
                    <span class="drawer-item-icon">üé®</span>
                    <span class="drawer-item-label">memerat<span style="color: var(--accent);">≈ç</span>r</span>
                </div>
                <div class="drawer-item" onclick="navigateTo('soundboard.html', 'soundboard')">
                    <span class="drawer-item-icon">üîä</span>
                    <span class="drawer-item-label">S<span style="color: var(--accent);">≈ç</span>unds</span>
                </div>
                <div class="drawer-item" onclick="toggleDicePanel()">
                    <span class="drawer-item-icon">üé≤</span>
                    <span class="drawer-item-label">d<span style="color: var(--accent);">≈ç</span>ice</span>
                </div>
                <div class="drawer-item" onclick="toggleStonks()">
                    <span class="drawer-item-icon">üìà</span>
                    <span class="drawer-item-label">st<span style="color: var(--accent);">≈ç</span>nks</span>
                </div>
            </div>
        </div>

        <!-- Mini Player -->
        <div class="mini-player" id="miniPlayer">
            <div class="mini-player-progress" id="miniPlayerProgress"></div>
            <div class="mini-player-art" id="miniPlayerArt">üéµ</div>
            <div class="mini-player-info">
                <div class="mini-player-title" id="miniPlayerTitle">Win<span style="color: var(--accent);">≈å</span>mp</div>
                <div class="mini-player-artist" id="miniPlayerArtist">No track loaded</div>
            </div>
            <div class="mini-player-controls">
                <button class="mini-player-btn" onclick="miniPlayerPrev()" title="Previous">‚èÆ</button>
                <button class="mini-player-btn play-btn" id="miniPlayerPlayBtn" onclick="miniPlayerToggle()" title="Play/Pause">‚ñ∂</button>
                <button class="mini-player-btn" onclick="miniPlayerNext()" title="Next">‚è≠</button>
                <button class="mini-player-btn" onclick="expandPlayer()" title="Expand Player">‚§¢</button>
            </div>
        </div>
    </div>

    <!-- Stock Ticker -->
    <div class="stock-ticker" id="stockTicker">
        <div class="ticker-content" id="tickerContent"></div>
    </div>

    <!-- Navigation -->
    <nav class="nav-ribbon">
        <div class="nav-left">
            <button class="drawer-toggle" id="drawerToggle" onclick="toggleDrawer()">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <span class="nav-brand"><span>≈ç</span>-face</span>
            <button class="nav-btn ronin-btn" data-page-id="ronin" onclick="navigateTo('ronin.html', 'ronin')">‚öîÔ∏è R≈çnin</button>
            <button class="nav-btn kabuki-btn" data-page-id="kabuki" onclick="navigateTo('kabuki.html', 'kabuki')">Kabuki</button>
            <button class="nav-btn meme-btn" data-page-id="memes" onclick="navigateTo('meme.html', 'memes')">Memes</button>
            <button class="nav-btn arcade-btn" data-page-id="arcade" onclick="navigateTo('arcade.html', 'arcade')">Arcade</button>
            <button class="nav-btn scorched-btn" data-page-id="scorched" onclick="navigateTo('scorched.html', 'scorched')">Scorched</button>
        </div>
        <div class="nav-right">
            <button class="window-btn" onclick="navMinimize()" title="Minimize">&#x2212;</button>
            <button class="window-btn" onclick="navMaximize()" title="Maximize">&#x25A1;</button>
            <button class="window-btn close" onclick="navClose()" title="Close">&#x2715;</button>
        </div>
    </nav>

    <div class="main-wrapper">
        <div class="dashboard-container">
            <!-- Loading overlay -->
            <div class="loading-overlay" id="loadingOverlay">
                <div class="loader"></div>
            </div>

            <!-- Dashboard home view with video -->
            <div id="dashboardView">
                <video id="introVideo" autoplay muted>
                    <source src="assets/mancorn.mp4" type="video/mp4">
                </video>
                <div class="skip-hint">Click anywhere to skip</div>
            </div>

            <!-- Content iframe for pages -->
            <iframe id="contentFrame" sandbox="allow-scripts allow-same-origin allow-forms allow-popups"></iframe>
        </div>
    </div>

    <script>
        // Create floating particles (disabled for performance)
        function createParticles() {
            // Disabled
        }
        // createParticles();

        // Dashboard state
        window.isDashboard = true;
        const LAST_PAGE_KEY = 'dashboard_last_page';
        const FAVORITES_KEY = 'meme_favorites';
        const PREFS_KEY = 'dashboard_prefs';
        const contentFrame = document.getElementById('contentFrame');
        const dashboardView = document.getElementById('dashboardView');
        const introVideo = document.getElementById('introVideo');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const pageTransition = document.getElementById('pageTransition');
        const leftDrawer = document.getElementById('leftDrawer');
        const drawerOverlay = document.getElementById('drawerOverlay');
        const drawerToggle = document.getElementById('drawerToggle');

        // Drawer toggle
        function toggleDrawer() {
            leftDrawer.classList.toggle('open');
            drawerOverlay.classList.toggle('active');
            drawerToggle.classList.toggle('active');
        }

        // Preferences toggle
        function togglePref(element, pref) {
            element.classList.toggle('active');
            const prefs = JSON.parse(localStorage.getItem(PREFS_KEY) || '{}');
            prefs[pref] = element.classList.contains('active');
            localStorage.setItem(PREFS_KEY, JSON.stringify(prefs));
        }

        // Load preferences
        function loadPrefs() {
            const prefs = JSON.parse(localStorage.getItem(PREFS_KEY) || '{"sound":true,"animations":true,"autoplay":true}');
            document.querySelectorAll('.pref-toggle').forEach(toggle => {
                const prefAttr = toggle.getAttribute('data-pref');
                if (prefAttr && prefs[prefAttr] === false) {
                    toggle.classList.remove('active');
                }
            });
        }

        // Load and display favorites from meme page storage
        function loadFavorites() {
            const container = document.getElementById('favoritesContainer');
            const gifs = JSON.parse(localStorage.getItem('favGifs') || '[]');
            const templates = JSON.parse(localStorage.getItem('favTemplates') || '[]');
            const memes = JSON.parse(localStorage.getItem('favMemes') || '[]');

            const totalCount = gifs.length + templates.length + memes.length;

            if (totalCount === 0) {
                container.innerHTML = `
                    <div class="favorites-empty">
                        <div class="favorites-empty-icon">‚≠ê</div>
                        <div>No favorites yet</div>
                        <div style="font-size: 11px; margin-top: 4px;">Star GIFs, templates, or save memes</div>
                    </div>
                `;
                return;
            }

            let html = '';

            // GIFs section
            if (gifs.length > 0) {
                html += `
                    <div class="fav-section">
                        <div class="fav-section-title">GIFs <span class="count">${gifs.length}</span></div>
                        <div class="fav-slider-wrapper">
                            <button class="fav-slider-arrow" onclick="slideFav('gifsSlider', -1)">‚óÄ</button>
                            <div class="fav-slider" id="gifsSlider">
                                <div class="favorites-grid">
                                    ${gifs.slice(0, 20).map((g, i) => `
                                        <div class="favorite-item" onclick="copyFavGif(this, ${i})" title="Click to copy">
                                            <img src="${g.previewUrl}" alt="${g.title || 'GIF'}">
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            <button class="fav-slider-arrow" onclick="slideFav('gifsSlider', 1)">‚ñ∂</button>
                        </div>
                    </div>
                `;
            }

            // Templates section
            if (templates.length > 0) {
                html += `
                    <div class="fav-section">
                        <div class="fav-section-title">Templates <span class="count">${templates.length}</span></div>
                        <div class="fav-slider-wrapper">
                            <button class="fav-slider-arrow" onclick="slideFav('templatesSlider', -1)">‚óÄ</button>
                            <div class="fav-slider" id="templatesSlider">
                                <div class="favorites-grid">
                                    ${templates.slice(0, 20).map((t, i) => `
                                        <div class="favorite-item" onclick="copyFavTemplate(this, ${i})" title="Click to copy">
                                            <img src="${t.url}" alt="${t.name}">
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            <button class="fav-slider-arrow" onclick="slideFav('templatesSlider', 1)">‚ñ∂</button>
                        </div>
                    </div>
                `;
            }

            // Created memes section
            if (memes.length > 0) {
                html += `
                    <div class="fav-section">
                        <div class="fav-section-title">Created <span class="count">${memes.length}</span></div>
                        <div class="fav-slider-wrapper">
                            <button class="fav-slider-arrow" onclick="slideFav('memesSlider', -1)">‚óÄ</button>
                            <div class="fav-slider" id="memesSlider">
                                <div class="favorites-grid">
                                    ${memes.slice(0, 20).map((m, i) => `
                                        <div class="favorite-item" onclick="copyFavMeme(this, ${i})" title="Click to copy">
                                            <img src="${m.data}" alt="Meme">
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            <button class="fav-slider-arrow" onclick="slideFav('memesSlider', 1)">‚ñ∂</button>
                        </div>
                    </div>
                `;
            }

            // View all button
            html += `
                <div class="fav-view-all">
                    <button class="fav-view-all-btn" onclick="openFavoritesPage()">View All Favorites</button>
                </div>
            `;

            container.innerHTML = html;
        }

        function slideFav(sliderId, direction) {
            const slider = document.getElementById(sliderId);
            if (slider) {
                slider.scrollBy({ left: direction * 120, behavior: 'smooth' });
            }
        }

        function flashItem(element) {
            element.classList.add('copied');
            setTimeout(() => element.classList.remove('copied'), 500);
        }

        async function copyFavGif(element, index) {
            const gifs = JSON.parse(localStorage.getItem('favGifs') || '[]');
            const gif = gifs[index];
            if (gif) {
                try {
                    await navigator.clipboard.writeText(gif.fullUrl);
                    flashItem(element);
                } catch (e) {
                    // Fallback: copy to temp input
                    const input = document.createElement('input');
                    input.value = gif.fullUrl;
                    document.body.appendChild(input);
                    input.select();
                    document.execCommand('copy');
                    document.body.removeChild(input);
                    flashItem(element);
                }
            }
        }

        async function copyFavTemplate(element, index) {
            const templates = JSON.parse(localStorage.getItem('favTemplates') || '[]');
            const template = templates[index];
            if (template) {
                try {
                    await navigator.clipboard.writeText(template.url);
                    flashItem(element);
                } catch (e) {
                    const input = document.createElement('input');
                    input.value = template.url;
                    document.body.appendChild(input);
                    input.select();
                    document.execCommand('copy');
                    document.body.removeChild(input);
                    flashItem(element);
                }
            }
        }

        async function copyFavMeme(element, index) {
            const memes = JSON.parse(localStorage.getItem('favMemes') || '[]');
            const meme = memes[index];
            if (meme) {
                try {
                    // For data URLs, try to copy as image
                    const blob = await (await fetch(meme.data)).blob();
                    await navigator.clipboard.write([
                        new ClipboardItem({ [blob.type]: blob })
                    ]);
                    flashItem(element);
                } catch (e) {
                    // Fallback: copy data URL as text
                    try {
                        await navigator.clipboard.writeText(meme.data);
                    } catch (e2) {
                        const input = document.createElement('input');
                        input.value = meme.data;
                        document.body.appendChild(input);
                        input.select();
                        document.execCommand('copy');
                        document.body.removeChild(input);
                    }
                    flashItem(element);
                }
            }
        }

        function openFavoritesPage() {
            navigateTo('meme.html', 'memes');
            setTimeout(() => {
                contentFrame.contentWindow.postMessage({ type: 'showFavoritesTab' }, '*');
            }, 500);
        }

        // Navigate to a content page with transition
        function navigateTo(href, pageId) {
            // Close drawer if open
            if (leftDrawer.classList.contains('open')) {
                toggleDrawer();
            }

            // Start transition
            pageTransition.classList.add('active');

            setTimeout(() => {
                dashboardView.style.display = 'none';
                contentFrame.classList.remove('loaded');
                contentFrame.style.display = 'block';
                loadingOverlay.classList.add('active');
                contentFrame.src = href;
                localStorage.setItem(LAST_PAGE_KEY, JSON.stringify({ href, pageId }));
                updateActiveButton(pageId);

                // End transition
                setTimeout(() => {
                    pageTransition.classList.remove('active');
                }, 100);
            }, 300);
        }

        // Handle iframe load
        contentFrame.addEventListener('load', () => {
            setTimeout(() => {
                loadingOverlay.classList.remove('active');
                contentFrame.classList.add('loaded');
            }, 100);
        });

        // Update active nav button
        function updateActiveButton(pageId) {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.pageId === pageId) {
                    btn.classList.add('active');
                }
            });
        }

        // Window controls
        function navMinimize() {
            if (window.electronAPI) window.electronAPI.window.minimize();
        }

        function navMaximize() {
            if (window.electronAPI) window.electronAPI.window.maximize();
        }

        function navClose() {
            if (window.electronAPI) window.electronAPI.window.close();
        }

        // Open terminal in separate window
        function openTerminal() {
            if (leftDrawer.classList.contains('open')) {
                toggleDrawer();
            }
            if (window.electronAPI) window.electronAPI.window.openTerminal();
        }

        // Open PortMaster in separate window
        function openPortmaster() {
            if (leftDrawer.classList.contains('open')) {
                toggleDrawer();
            }
            if (window.electronAPI) window.electronAPI.window.openPortmaster();
        }

        // Open VRAM Spy in separate window
        function openVramSpy() {
            if (leftDrawer.classList.contains('open')) {
                toggleDrawer();
            }
            if (window.electronAPI) window.electronAPI.window.openVramSpy();
        }

        // Music player toggle (for full player in iframe)
        function togglePlayer() {
            if (contentFrame.style.display !== 'none' && contentFrame.contentWindow) {
                try {
                    if (typeof contentFrame.contentWindow.togglePlayer === 'function') {
                        contentFrame.contentWindow.togglePlayer();
                        return;
                    }
                } catch (e) {
                    console.log('Direct call failed, trying postMessage');
                }
                contentFrame.contentWindow.postMessage({ type: 'togglePlayer' }, '*');
            }
        }

        // ============================================
        // MINI PLAYER
        // ============================================
        const miniPlayerAudio = new Audio();
        let miniPlayerPlaying = false;
        let miniPlayerTrackIndex = 0;

        // Playlist from assets/music
        const miniPlayerPlaylist = [
            { title: 'Crush', artist: 'Giorgio Vitt√©', src: 'assets/music/Giorgio Vitt√© - Crush.mp3' },
            { title: 'MOVIN', artist: 'dannyminus', src: 'assets/music/dannyminus - MOVIN.mp3' },
            { title: 'Bitchin Sauce', artist: 'CHAE 13', src: 'assets/music/CHAE 13 - Bitchin Sauce.mp3' },
            { title: 'Pharisees', artist: 'Art1fact', src: 'assets/music/Art1fact - Pharisees.mp3' },
            { title: 'Hell Awakens', artist: 'Flint', src: 'assets/music/Flint - Hell Awakens.mp3' },
            { title: 'Eremite', artist: 'Art1fact', src: 'assets/music/Art1fact - Eremite.mp3' },
            { title: 'On up on Winning', artist: 'Ariel Dahan', src: 'assets/music/Ariel Dahan - On up on Winning - Instrumental version.mp3' },
            { title: 'Really Want It', artist: 'Zooki', src: 'assets/music/Zooki - Really Want It - Instrumental version.mp3' },
            { title: 'Devotion', artist: 'Art1fact', src: 'assets/music/Art1fact - Devotion.mp3' },
            { title: 'Different Now', artist: 'Win≈åmp', src: 'assets/music/different-now.mp3' },
            { title: 'Digital Ascension', artist: 'Win≈åmp', src: 'assets/music/digital-ascension.mp3' },
            { title: 'Blood and Thunder', artist: 'Win≈åmp', src: 'assets/music/blood-and-thunder.mp3' }
        ];

        // Mini player elements
        const miniPlayerTitle = document.getElementById('miniPlayerTitle');
        const miniPlayerArtist = document.getElementById('miniPlayerArtist');
        const miniPlayerPlayBtn = document.getElementById('miniPlayerPlayBtn');
        const miniPlayerProgress = document.getElementById('miniPlayerProgress');

        // Toggle play/pause
        function miniPlayerToggle() {
            if (miniPlayerPlaying) {
                miniPlayerAudio.pause();
                miniPlayerPlaying = false;
                if (miniPlayerPlayBtn) miniPlayerPlayBtn.textContent = '‚ñ∂';
                if (fullPlayerPlayBtn) fullPlayerPlayBtn.textContent = '‚ñ∂';
            } else {
                // Load track if not loaded
                if (!miniPlayerAudio.src || miniPlayerAudio.src === '') {
                    loadMiniPlayerTrack(0);
                }
                miniPlayerAudio.play().catch(e => console.log('Audio play error:', e));
                miniPlayerPlaying = true;
                if (miniPlayerPlayBtn) miniPlayerPlayBtn.textContent = '‚è∏';
                if (fullPlayerPlayBtn) fullPlayerPlayBtn.textContent = '‚è∏';
            }
            updateWinampDisplay();
        }

        // Previous track
        function miniPlayerPrev() {
            miniPlayerTrackIndex = (miniPlayerTrackIndex - 1 + miniPlayerPlaylist.length) % miniPlayerPlaylist.length;
            loadMiniPlayerTrack(miniPlayerTrackIndex);
            if (miniPlayerPlaying) {
                miniPlayerAudio.play().catch(e => console.log('Audio play error:', e));
            }
            updateWinampDisplay();
            renderWinampPlaylist();
        }

        // Next track
        function miniPlayerNext() {
            miniPlayerTrackIndex = (miniPlayerTrackIndex + 1) % miniPlayerPlaylist.length;
            loadMiniPlayerTrack(miniPlayerTrackIndex);
            if (miniPlayerPlaying) {
                miniPlayerAudio.play().catch(e => console.log('Audio play error:', e));
            }
            updateWinampDisplay();
            renderWinampPlaylist();
        }

        // Load a track
        function loadMiniPlayerTrack(index) {
            if (miniPlayerPlaylist.length === 0) return;
            const track = miniPlayerPlaylist[index];
            miniPlayerAudio.src = track.src;
            // Update mini player
            if (miniPlayerTitle) miniPlayerTitle.textContent = track.title;
            if (miniPlayerArtist) miniPlayerArtist.textContent = track.artist;
            if (miniPlayerProgress) miniPlayerProgress.style.width = '0%';
            // Update full player
            if (fullPlayerTitle) fullPlayerTitle.textContent = track.title;
            if (fullPlayerArtist) fullPlayerArtist.textContent = track.artist;
            if (fullPlayerProgressBar) fullPlayerProgressBar.style.width = '0%';
        }

        // Initialize first track display
        if (miniPlayerPlaylist.length > 0) {
            const firstTrack = miniPlayerPlaylist[0];
            if (miniPlayerTitle) miniPlayerTitle.textContent = firstTrack.title;
            if (miniPlayerArtist) miniPlayerArtist.textContent = firstTrack.artist;
        }

        // WinAmp Player elements
        const winampPanel = document.getElementById('winampPanel');
        const winampTrackName = document.getElementById('winampTrackName');
        const winampTime = document.getElementById('winampTime');
        const winampSeek = document.getElementById('winampSeek');
        const winampPlayBtn = document.getElementById('winampPlayBtn');
        const winampVolume = document.getElementById('winampVolume');
        const winampPlaylist = document.getElementById('winampPlaylist');
        const winampCanvas = document.getElementById('winampCanvas');
        const screensaverOverlay = document.getElementById('screensaverOverlay');
        const screensaverCanvas = document.getElementById('screensaverCanvas');
        let audioContext, analyser, dataArray;
        let screensaverAnimId = null;
        let currentScreensaver = 'matrix';

        // Expand to WinAmp player
        function expandPlayer() {
            if (leftDrawer.classList.contains('open')) {
                toggleDrawer();
            }
            updateWinampDisplay();
            renderWinampPlaylist();
            winampPanel.classList.add('open');
            initVisualizer();
        }

        function closeWinamp() {
            winampPanel.classList.remove('open');
        }

        function updateWinampDisplay() {
            if (miniPlayerPlaylist.length > 0) {
                const track = miniPlayerPlaylist[miniPlayerTrackIndex];
                winampTrackName.textContent = `${track.artist} - ${track.title}`;
            }
            winampPlayBtn.textContent = miniPlayerPlaying ? '‚è∏' : '‚ñ∂';
            winampVolume.value = miniPlayerAudio.volume * 100;
        }

        function renderWinampPlaylist() {
            winampPlaylist.innerHTML = miniPlayerPlaylist.map((track, i) => `
                <div class="winamp-playlist-item ${i === miniPlayerTrackIndex ? 'active' : ''}"
                     onclick="playWinampTrack(${i})"
                     ondblclick="playWinampTrack(${i})"
                     title="Click to play: ${track.title}">
                    ${i + 1}. ${track.artist} - ${track.title}
                </div>
            `).join('');
        }

        function playWinampTrack(index) {
            miniPlayerTrackIndex = index;
            loadMiniPlayerTrack(index);
            miniPlayerAudio.play().then(() => {
                miniPlayerPlaying = true;
                updateWinampDisplay();
                updateMiniPlayerUI();
            }).catch(e => console.log('Audio play error:', e));
            renderWinampPlaylist();
        }

        function seekWinamp(value) {
            if (miniPlayerAudio.duration) {
                miniPlayerAudio.currentTime = (value / 100) * miniPlayerAudio.duration;
            }
        }

        function setWinampVolume(value) {
            miniPlayerAudio.volume = value / 100;
        }

        function stopWinamp() {
            miniPlayerAudio.pause();
            miniPlayerAudio.currentTime = 0;
            miniPlayerPlaying = false;
            updateMiniPlayerUI();
            updateWinampDisplay();
        }

        function clearWinampPlaylist() {
            // Keep default tracks, just reset
            miniPlayerTrackIndex = 0;
            renderWinampPlaylist();
        }

        function openAudioFiles() {
            if (window.electronAPI && window.electronAPI.openAudioFiles) {
                window.electronAPI.openAudioFiles();
            }
        }

        function formatTime(seconds) {
            if (!seconds || isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Visualizer
        function initVisualizer() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 256;
                const source = audioContext.createMediaElementSource(miniPlayerAudio);
                source.connect(analyser);
                analyser.connect(audioContext.destination);
                dataArray = new Uint8Array(analyser.frequencyBinCount);
            }
            drawVisualizer();
        }

        function drawVisualizer() {
            if (!winampPanel.classList.contains('open')) return;
            requestAnimationFrame(drawVisualizer);

            const ctx = winampCanvas.getContext('2d');
            const width = winampCanvas.width = winampCanvas.offsetWidth;
            const height = winampCanvas.height = winampCanvas.offsetHeight;

            analyser.getByteFrequencyData(dataArray);

            ctx.fillStyle = '#0a0a0f';
            ctx.fillRect(0, 0, width, height);

            const barWidth = width / dataArray.length * 2;
            let x = 0;

            for (let i = 0; i < dataArray.length; i++) {
                const barHeight = (dataArray[i] / 255) * height;
                const hue = (i / dataArray.length) * 120;
                ctx.fillStyle = `hsl(${hue}, 100%, 50%)`;
                ctx.fillRect(x, height - barHeight, barWidth - 1, barHeight);
                x += barWidth;
            }
        }

        // Screensavers
        function openScreensaver() {
            screensaverOverlay.classList.add('active');
            startScreensaver();
        }

        function closeScreensaver() {
            screensaverOverlay.classList.remove('active');
            if (screensaverAnimId) {
                cancelAnimationFrame(screensaverAnimId);
                screensaverAnimId = null;
            }
        }

        function startScreensaver() {
            const ctx = screensaverCanvas.getContext('2d');
            screensaverCanvas.width = window.innerWidth;
            screensaverCanvas.height = window.innerHeight;

            // Matrix rain effect
            const fontSize = 16;
            const columns = Math.floor(screensaverCanvas.width / fontSize);
            const drops = Array(columns).fill(1);
            const chars = '≈ç„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩ„Çø„ÉÅ„ÉÑ„ÉÜ„Éà„Éä„Éã„Éå„Éç„Éé„Éè„Éí„Éï„Éò„Éõ„Éû„Éü„É†„É°„É¢„É§„É¶„É®„É©„É™„É´„É¨„É≠„ÉØ„É≤„É≥0123456789'.split('');

            function drawMatrix() {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
                ctx.fillRect(0, 0, screensaverCanvas.width, screensaverCanvas.height);

                ctx.fillStyle = '#0f0';
                ctx.font = `${fontSize}px monospace`;

                for (let i = 0; i < drops.length; i++) {
                    const char = chars[Math.floor(Math.random() * chars.length)];
                    const x = i * fontSize;
                    const y = drops[i] * fontSize;

                    // Random red ≈ç
                    if (char === '≈ç') {
                        ctx.fillStyle = '#C52638';
                        ctx.fillText(char, x, y);
                        ctx.fillStyle = '#0f0';
                    } else {
                        ctx.fillText(char, x, y);
                    }

                    if (y > screensaverCanvas.height && Math.random() > 0.975) {
                        drops[i] = 0;
                    }
                    drops[i]++;
                }

                screensaverAnimId = requestAnimationFrame(drawMatrix);
            }

            drawMatrix();
        }

        // ============================================
        // ≈ç-ICE DICE ROLLER - PHYSICS ENGINE
        // ============================================
        let selectedDiceType = 20;
        const dicePanel = document.getElementById('dicePanel');
        const diceArenaFullscreen = document.getElementById('diceArenaFullscreen');
        let diceHistory = [];
        let physicsActive = false;
        let physicsAnimationId = null;

        function toggleDicePanel() {
            if (dicePanel.classList.contains('open')) {
                closeDicePanel();
            } else {
                openDicePanel();
            }
        }

        function openDicePanel() {
            // Clear any inline styles so CSS class takes effect
            dicePanel.style.transform = '';
            dicePanel.style.opacity = '';
            dicePanel.classList.add('open');
            // Close drawer if open
            if (leftDrawer.classList.contains('open')) {
                toggleDrawer();
            }
        }

        function closeDicePanel() {
            dicePanel.classList.remove('open');
        }

        function selectDice(sides) {
            selectedDiceType = sides;
            document.querySelectorAll('.dice-type-btn').forEach(btn => {
                btn.classList.remove('selected');
                if (parseInt(btn.dataset.dice) === sides) {
                    btn.classList.add('selected');
                }
            });
        }

        // Physics simulation class for each die
        class PhysicsDie {
            constructor(x, y, diceType, value) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 25;
                this.vy = Math.random() * -15 - 10;
                this.rotX = Math.random() * 360;
                this.rotY = Math.random() * 360;
                this.rotZ = Math.random() * 360;
                this.vRotX = (Math.random() - 0.5) * 30;
                this.vRotY = (Math.random() - 0.5) * 30;
                this.vRotZ = (Math.random() - 0.5) * 30;
                this.diceType = diceType;
                this.value = value;
                this.bounces = 0;
                this.settled = false;
                this.element = null;
                this.shadow = null;
            }

            update(gravity, friction, bounciness, floorY) {
                if (this.settled) return;

                // Apply gravity
                this.vy += gravity;

                // Apply velocity
                this.x += this.vx;
                this.y += this.vy;

                // Rotation
                this.rotX += this.vRotX;
                this.rotY += this.vRotY;
                this.rotZ += this.vRotZ;

                // Bounce off floor
                if (this.y > floorY) {
                    this.y = floorY;
                    this.vy *= -bounciness;
                    this.vx *= friction;
                    this.vRotX *= 0.7;
                    this.vRotY *= 0.7;
                    this.vRotZ *= 0.7;
                    this.bounces++;

                    // Create spark effect
                    if (Math.abs(this.vy) > 2) {
                        createBounceSpark(this.x + 35, this.y + 35);
                    }

                    // Check if settled
                    if (Math.abs(this.vy) < 0.5 && Math.abs(this.vx) < 0.5) {
                        this.settled = true;
                        this.vy = 0;
                        this.vx = 0;
                        this.vRotX = 0;
                        this.vRotY = 0;
                        this.vRotZ = 0;
                    }
                }

                // Bounce off walls
                const maxX = window.innerWidth - 100;
                if (this.x < 50) {
                    this.x = 50;
                    this.vx *= -bounciness;
                }
                if (this.x > maxX) {
                    this.x = maxX;
                    this.vx *= -bounciness;
                }

                // Apply air friction
                this.vx *= 0.995;
                this.vRotX *= 0.99;
                this.vRotY *= 0.99;
                this.vRotZ *= 0.99;
            }

            render() {
                if (!this.element) return;
                this.element.style.left = this.x + 'px';
                this.element.style.top = this.y + 'px';
                const inner = this.element.querySelector('.die-inner');
                if (inner) {
                    inner.style.transform = `rotateX(${this.rotX}deg) rotateY(${this.rotY}deg) rotateZ(${this.rotZ}deg)`;
                }
                // Shadow
                if (this.shadow) {
                    const floorY = window.innerHeight - 150;
                    const distFromFloor = floorY - this.y;
                    const shadowScale = Math.max(0.3, 1 - distFromFloor / 400);
                    const shadowOpacity = Math.max(0.1, 0.4 - distFromFloor / 600);
                    this.shadow.style.left = (this.x + 5) + 'px';
                    this.shadow.style.top = (floorY + 50) + 'px';
                    this.shadow.style.transform = `scale(${shadowScale})`;
                    this.shadow.style.opacity = shadowOpacity;
                }
            }
        }

        function createBounceSpark(x, y) {
            const arena = diceArenaFullscreen;
            for (let i = 0; i < 5; i++) {
                const spark = document.createElement('div');
                spark.className = 'bounce-spark';
                spark.style.left = (x + (Math.random() - 0.5) * 30) + 'px';
                spark.style.top = (y + (Math.random() - 0.5) * 20) + 'px';
                arena.appendChild(spark);
                setTimeout(() => spark.remove(), 500);
            }
        }

        // Create 3D dice shape based on type
        function createPhysicsDieElement(diceType, value) {
            const container = document.createElement('div');
            container.className = 'physics-die';

            const inner = document.createElement('div');
            inner.className = 'die-inner';

            switch(diceType) {
                case 4: // D4 Tetrahedron
                    inner.classList.add('d4-tetra');
                    for (let i = 1; i <= 4; i++) {
                        const face = document.createElement('div');
                        face.className = `tetra-face face-${i}`;
                        face.innerHTML = `<span>${i === 1 ? value : Math.floor(Math.random() * 4) + 1}</span>`;
                        inner.appendChild(face);
                    }
                    break;

                case 6: // D6 Cube with pips
                    inner.classList.add('d6-cube');
                    const faces = ['front', 'back', 'right', 'left', 'top', 'bottom'];
                    const faceValues = [value, 7 - value,
                        ((value + 1) % 6) || 6,
                        ((value + 3) % 6) || 6,
                        ((value + 2) % 6) || 6,
                        ((value + 4) % 6) || 6];
                    faces.forEach((face, idx) => {
                        const faceEl = document.createElement('div');
                        faceEl.className = `cube-face cube-${face}`;
                        faceEl.appendChild(createPipGrid(faceValues[idx]));
                        inner.appendChild(faceEl);
                    });
                    break;

                case 8: // D8 Octahedron
                    inner.classList.add('d8-octa');
                    for (let i = 1; i <= 8; i++) {
                        const face = document.createElement('div');
                        face.className = `octa-face face-${i}`;
                        face.innerHTML = `<span>${i === 1 ? value : Math.floor(Math.random() * 8) + 1}</span>`;
                        inner.appendChild(face);
                    }
                    break;

                case 10: // D10
                    inner.classList.add('d10-penta');
                    const d10Face = document.createElement('div');
                    d10Face.className = 'd10-face';
                    d10Face.textContent = value === 10 ? '0' : value;
                    d10Face.style.width = '55px';
                    d10Face.style.height = '75px';
                    d10Face.style.fontSize = '24px';
                    inner.appendChild(d10Face);
                    break;

                case 12: // D12 Dodecahedron
                    inner.classList.add('d12-dodeca');
                    const d12Face = document.createElement('div');
                    d12Face.className = 'dodeca-face';
                    d12Face.textContent = value;
                    d12Face.style.width = '65px';
                    d12Face.style.height = '65px';
                    d12Face.style.fontSize = '24px';
                    inner.appendChild(d12Face);
                    break;

                case 20: // D20 Icosahedron
                    inner.classList.add('d20-icosa');
                    // Create visible triangular face with value
                    for (let i = 0; i < 5; i++) {
                        const face = document.createElement('div');
                        face.className = 'icosa-face';
                        const angle = i * 72;
                        face.style.transform = `rotateY(${angle}deg) translateZ(35px)`;
                        face.innerHTML = `<span>${i === 0 ? value : Math.floor(Math.random() * 20) + 1}</span>`;
                        inner.appendChild(face);
                    }
                    // Add more faces for 3D effect
                    for (let i = 0; i < 5; i++) {
                        const face = document.createElement('div');
                        face.className = 'icosa-face';
                        const angle = i * 72 + 36;
                        face.style.transform = `rotateX(52deg) rotateY(${angle}deg) translateZ(35px)`;
                        face.innerHTML = `<span>${Math.floor(Math.random() * 20) + 1}</span>`;
                        inner.appendChild(face);
                    }
                    break;

                default:
                    inner.classList.add('d6-cube');
                    const defaultFaces = ['front', 'back', 'right', 'left', 'top', 'bottom'];
                    defaultFaces.forEach((face, idx) => {
                        const faceEl = document.createElement('div');
                        faceEl.className = `cube-face cube-${face}`;
                        faceEl.appendChild(createPipGrid(idx === 0 ? value : idx + 1));
                        inner.appendChild(faceEl);
                    });
            }

            container.appendChild(inner);
            return container;
        }

        function createPipGrid(num) {
            const grid = document.createElement('div');
            grid.className = `pip-grid pip-${num}`;

            // Pip patterns for D6
            const patterns = {
                1: [4],
                2: [0, 8],
                3: [0, 4, 8],
                4: [0, 2, 6, 8],
                5: [0, 2, 4, 6, 8],
                6: [0, 2, 3, 5, 6, 8]
            };

            for (let i = 0; i < 9; i++) {
                if (patterns[num]?.includes(i)) {
                    const pip = document.createElement('div');
                    pip.className = 'pip';
                    grid.appendChild(pip);
                }
            }
            return grid;
        }

        function rollDiceFullscreen() {
            const quantity = Math.min(10, Math.max(1, parseInt(document.getElementById('diceQuantity').value) || 1));
            const arena = diceArenaFullscreen;
            const resultPopup = document.getElementById('diceResultPopup');

            // Clear any existing elements
            arena.querySelectorAll('.physics-die, .die-shadow, .bounce-spark').forEach(d => d.remove());
            resultPopup.classList.remove('show', 'crit', 'nat1');

            // Show fullscreen arena
            arena.style.display = 'block';
            setTimeout(() => arena.classList.add('active'), 10);

            const dice = [];
            const results = [];
            const floorY = window.innerHeight - 200;
            const gravity = 0.8;
            const friction = 0.85;
            const bounciness = 0.6;

            // Create dice with physics
            for (let i = 0; i < quantity; i++) {
                const value = Math.floor(Math.random() * selectedDiceType) + 1;
                results.push(value);

                // Starting position - throw from different positions
                const startX = 100 + Math.random() * (window.innerWidth - 300);
                const startY = -100 - i * 50;

                const die = new PhysicsDie(startX, startY, selectedDiceType, value);
                die.vx = (Math.random() - 0.5) * 20;
                die.vy = 5 + Math.random() * 10;

                // Create DOM element
                die.element = createPhysicsDieElement(selectedDiceType, value);

                // Check for crit/nat1
                const isCrit = (selectedDiceType === 20 && value === 20) || value === selectedDiceType;
                const isNat1 = selectedDiceType === 20 && value === 1;
                if (isCrit) die.element.classList.add('crit');
                if (isNat1) die.element.classList.add('nat1');

                arena.appendChild(die.element);

                // Create shadow
                die.shadow = document.createElement('div');
                die.shadow.className = 'die-shadow';
                arena.appendChild(die.shadow);

                dice.push(die);
            }

            // Physics simulation loop
            physicsActive = true;
            let frameCount = 0;
            const maxFrames = 300; // ~5 seconds at 60fps

            function physicsLoop() {
                if (!physicsActive) return;

                frameCount++;
                let allSettled = true;

                dice.forEach(die => {
                    die.update(gravity, friction, bounciness, floorY);
                    die.render();
                    if (!die.settled) allSettled = false;
                });

                // End conditions
                if (allSettled || frameCount > maxFrames) {
                    physicsActive = false;
                    showDiceResults(results, quantity);
                } else {
                    physicsAnimationId = requestAnimationFrame(physicsLoop);
                }
            }

            physicsAnimationId = requestAnimationFrame(physicsLoop);

            // Allow clicking to close after delay
            setTimeout(() => {
                arena.onclick = closeFullscreenDice;
            }, 1000);
        }

        function showDiceResults(results, quantity) {
            const resultPopup = document.getElementById('diceResultPopup');
            const total = results.reduce((a, b) => a + b, 0);
            const breakdown = results.join(' + ');
            const hasCrit = results.some(v => v === selectedDiceType || (selectedDiceType === 20 && v === 20));
            const hasNat1 = selectedDiceType === 20 && results.some(v => v === 1);

            document.getElementById('diceResultTotal').textContent = `${hasCrit ? 'üî• ' : ''}${total}${hasCrit ? ' üî•' : ''}${hasNat1 ? ' üíÄ' : ''}`;
            document.getElementById('diceResultBreakdown').textContent = `${quantity}d${selectedDiceType}: ${breakdown}`;

            resultPopup.classList.add('show');
            if (hasCrit) resultPopup.classList.add('crit');
            if (hasNat1) resultPopup.classList.add('nat1');

            // Add to history
            addDiceToHistory(quantity, selectedDiceType, total, hasCrit, hasNat1);

            // Auto-close after showing results
            setTimeout(() => {
                closeFullscreenDice();
            }, 3000);
        }

        function closeFullscreenDice() {
            physicsActive = false;
            if (physicsAnimationId) {
                cancelAnimationFrame(physicsAnimationId);
                physicsAnimationId = null;
            }

            const arena = diceArenaFullscreen;
            const resultPopup = document.getElementById('diceResultPopup');

            resultPopup.classList.remove('show');
            arena.classList.remove('active');
            arena.onclick = null;

            setTimeout(() => {
                arena.style.display = 'none';
                arena.querySelectorAll('.physics-die, .die-shadow, .bounce-spark').forEach(d => d.remove());
            }, 300);
        }

        function addDiceToHistory(quantity, diceType, total, isCrit, isNat1) {
            const historyEl = document.getElementById('diceHistory');

            // Create history item
            const item = document.createElement('div');
            item.className = 'dice-history-item';
            if (isCrit) item.classList.add('crit');
            if (isNat1) item.classList.add('nat1');

            item.innerHTML = `
                <span class="roll-type">${quantity}d${diceType}</span>
                <span class="roll-result">${isCrit ? 'üî• ' : ''}${total}${isNat1 ? ' üíÄ' : ''}</span>
            `;

            // Clear placeholder if first roll
            if (diceHistory.length === 0) {
                historyEl.innerHTML = '';
            }

            historyEl.insertBefore(item, historyEl.firstChild);
            diceHistory.unshift({ quantity, diceType, total, isCrit, isNat1 });

            // Keep only last 10 rolls
            if (diceHistory.length > 10) {
                diceHistory.pop();
                if (historyEl.lastChild) historyEl.removeChild(historyEl.lastChild);
            }
        }

        // Click anywhere on fullscreen to close early (after initial delay)
        // Handled dynamically in rollDiceFullscreen

        // ============================================
        // DRAGGABLE PANELS
        // ============================================
        function makeDraggable(panel, handle) {
            let isDragging = false;
            let startX, startY, initialX, initialY;

            handle.addEventListener('mousedown', (e) => {
                if (e.target.tagName === 'BUTTON') return; // Don't drag when clicking buttons
                isDragging = true;
                panel.classList.add('dragging');

                const rect = panel.getBoundingClientRect();
                const computedStyle = window.getComputedStyle(panel);
                // Remove transform centering on first drag
                if (computedStyle.transform !== 'none' || panel.style.left === '50%') {
                    panel.style.left = rect.left + 'px';
                    panel.style.top = rect.top + 'px';
                    panel.style.transform = 'none';
                }

                startX = e.clientX;
                startY = e.clientY;
                initialX = rect.left;
                initialY = rect.top;

                e.preventDefault();
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;

                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;

                let newX = initialX + deltaX;
                let newY = initialY + deltaY;

                // Keep panel within viewport
                const panelRect = panel.getBoundingClientRect();
                newX = Math.max(0, Math.min(newX, window.innerWidth - panelRect.width));
                newY = Math.max(0, Math.min(newY, window.innerHeight - panelRect.height));

                panel.style.left = newX + 'px';
                panel.style.top = newY + 'px';
            });

            document.addEventListener('mouseup', () => {
                if (isDragging) {
                    isDragging = false;
                    panel.classList.remove('dragging');
                }
            });
        }

        // Make dice panel draggable
        const dicePanelHeader = document.querySelector('.dice-panel-header');
        if (dicePanelHeader) {
            makeDraggable(dicePanel, dicePanelHeader);
        }

        // Make WinAmp panel draggable
        const winampTitlebar = document.querySelector('.winamp-titlebar');
        if (winampPanel && winampTitlebar) {
            makeDraggable(winampPanel, winampTitlebar);
        }

        // ============================================
        // ST≈åNKS TICKER (Real Stock Data)
        // ============================================
        const stockTicker = document.getElementById('stockTicker');
        const tickerContent = document.getElementById('tickerContent');
        let stonksActive = false;
        let stockCache = [];

        // Real stock symbols to track
        const realStocks = ['AAPL', 'GOOGL', 'MSFT', 'AMZN', 'TSLA', 'NVDA', 'META', 'GME', 'AMC', 'AMD', 'INTC', 'NFLX', 'DIS', 'COIN', 'PLTR'];

        // Base prices for realistic simulation (Yahoo Finance has CORS issues)
        const basePrices = {
            'AAPL': 178.50, 'GOOGL': 141.80, 'MSFT': 378.90, 'AMZN': 178.25, 'TSLA': 248.50,
            'NVDA': 875.30, 'META': 505.75, 'GME': 17.85, 'AMC': 4.92, 'AMD': 156.40,
            'INTC': 31.25, 'NFLX': 628.90, 'DIS': 112.45, 'COIN': 225.60, 'PLTR': 24.85
        };

        // Simulate realistic stock movements
        function simulateStockData() {
            return realStocks.map(symbol => {
                const basePrice = basePrices[symbol] || 100;
                // Add some randomness but keep it realistic (¬±3%)
                const variance = (Math.random() - 0.5) * 0.06;
                const price = basePrice * (1 + variance);
                const change = price - basePrice;
                const percent = (change / basePrice) * 100;

                return {
                    symbol,
                    name: symbol,
                    price: price.toFixed(2),
                    change: change.toFixed(2),
                    percent: percent.toFixed(2),
                    isUp: change >= 0
                };
            });
        }

        // Fetch real stock data (with fallback to simulation)
        async function fetchStockData() {
            try {
                // Try Finnhub API (free tier, CORS-friendly)
                const promises = realStocks.slice(0, 5).map(async symbol => {
                    const response = await fetch(`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=demo`);
                    if (!response.ok) throw new Error('API limit');
                    return response.json();
                });

                const results = await Promise.all(promises);
                const hasValidData = results.some(r => r.c > 0);

                if (hasValidData) {
                    stockCache = results.map((data, i) => {
                        const symbol = realStocks[i];
                        const price = data.c || basePrices[symbol];
                        const prevClose = data.pc || price;
                        const change = price - prevClose;
                        return {
                            symbol,
                            name: symbol,
                            price: price.toFixed(2),
                            change: change.toFixed(2),
                            percent: ((change / prevClose) * 100).toFixed(2),
                            isUp: change >= 0
                        };
                    });
                    // Add simulated data for the rest
                    const simulated = simulateStockData().slice(5);
                    stockCache = [...stockCache, ...simulated];
                } else {
                    throw new Error('No valid data');
                }
            } catch (error) {
                console.log('Using simulated stock data');
                stockCache = simulateStockData();
            }
            return stockCache;
        }

        function renderTicker(data) {
            if (!data || data.length === 0) {
                tickerContent.innerHTML = '<span class="ticker-item">Loading st≈çnks...</span>';
                return;
            }
            // Duplicate for seamless scrolling
            const items = [...data, ...data].map(stock => `
                <span class="ticker-item">
                    <span class="ticker-symbol">${stock.symbol}</span>
                    <span class="ticker-price">$${stock.price}</span>
                    <span class="ticker-change ${stock.isUp ? 'up' : 'down'}">${stock.isUp ? '+' : ''}${stock.change} (${stock.isUp ? '+' : ''}${stock.percent}%)</span>
                </span>
                <span class="ticker-separator">‚îÇ</span>
            `).join('');
            tickerContent.innerHTML = items;
        }

        async function toggleStonks() {
            stonksActive = !stonksActive;
            if (stonksActive) {
                stockTicker.classList.add('active');
                document.body.classList.add('stonks-active');
                // Close drawer if open
                if (leftDrawer.classList.contains('open')) {
                    toggleDrawer();
                }
                // Show loading state
                renderTicker([]);
                // Fetch and display real data
                const data = await fetchStockData();
                renderTicker(data);
            } else {
                stockTicker.classList.remove('active');
                document.body.classList.remove('stonks-active');
            }
        }

        // Update ticker prices every 30 seconds (be nice to the API)
        setInterval(async () => {
            if (stonksActive) {
                const data = await fetchStockData();
                renderTicker(data);
            }
        }, 30000);

        // Update progress bar (mini and WinAmp player)
        miniPlayerAudio.addEventListener('timeupdate', () => {
            if (miniPlayerAudio.duration) {
                const progress = (miniPlayerAudio.currentTime / miniPlayerAudio.duration) * 100;
                if (miniPlayerProgress) miniPlayerProgress.style.width = progress + '%';
                // WinAmp updates
                if (winampSeek) winampSeek.value = progress;
                if (winampTime) winampTime.textContent = formatTime(miniPlayerAudio.currentTime);
            }
        });

        // Auto play next track
        miniPlayerAudio.addEventListener('ended', () => {
            miniPlayerTrackIndex = (miniPlayerTrackIndex + 1) % miniPlayerPlaylist.length;
            loadMiniPlayerTrack(miniPlayerTrackIndex);
            miniPlayerAudio.play().catch(e => console.log('Audio play error:', e));
            updateWinampDisplay();
            renderWinampPlaylist();
        });

        // Listen for track updates from iframe (Win≈åmp full player)
        window.addEventListener('message', (event) => {
            const { data } = event;
            if (data && data.type === 'miniPlayerUpdate') {
                if (miniPlayerTitle) miniPlayerTitle.textContent = data.title || 'Unknown';
                if (miniPlayerArtist) miniPlayerArtist.textContent = data.artist || 'Unknown';
                if (data.playing !== undefined) {
                    miniPlayerPlaying = data.playing;
                    if (miniPlayerPlayBtn) miniPlayerPlayBtn.textContent = data.playing ? '‚è∏' : '‚ñ∂';
                }
            }
        });

        // After video ends, navigate to Ronin with A-Team theme
        function showDefaultPage() {
            introVideo.style.opacity = '0';
            introVideo.style.transform = 'scale(0.95)';
            const skipHint = document.querySelector('.skip-hint');
            if (skipHint) skipHint.style.opacity = '0';

            setTimeout(() => {
                // Set A-Team as default theme for Ronin
                localStorage.setItem('ronin_theme', 'ateam');
                // Navigate to Ronin page
                navigateTo('ronin.html', 'ronin');
            }, 600);
        }

        introVideo.addEventListener('ended', showDefaultPage);
        introVideo.addEventListener('click', showDefaultPage);
        introVideo.addEventListener('error', () => {
            console.error('Video failed to load');
            showDefaultPage();
        });

        // Message bridge for iframe communication
        window.addEventListener('message', (event) => {
            const { data } = event;
            if (!data || !data.type) return;

            // Handle electronAPI calls from iframe
            if (data.type === 'electronAPI' && window.electronAPI) {
                const { id, method, args = [] } = data;
                const [obj, func] = method.split('.');

                try {
                    let result;
                    if (window.electronAPI[obj] && typeof window.electronAPI[obj][func] === 'function') {
                        result = window.electronAPI[obj][func](...args);
                    }

                    if (result && typeof result.then === 'function') {
                        result.then(res => {
                            contentFrame.contentWindow.postMessage({
                                type: 'electronAPI-response',
                                id,
                                result: res
                            }, '*');
                        }).catch(err => {
                            contentFrame.contentWindow.postMessage({
                                type: 'electronAPI-response',
                                id,
                                error: err.message
                            }, '*');
                        });
                    } else {
                        contentFrame.contentWindow.postMessage({
                            type: 'electronAPI-response',
                            id,
                            result
                        }, '*');
                    }
                } catch (err) {
                    contentFrame.contentWindow.postMessage({
                        type: 'electronAPI-response',
                        id,
                        error: err.message
                    }, '*');
                }
            }

            if (data.type === 'getPlatform' && window.electronAPI) {
                contentFrame.contentWindow.postMessage({
                    type: 'platform',
                    platform: window.electronAPI.platform
                }, '*');
            }

            if (data.type === 'navigate') {
                if (data.href) {
                    navigateTo(data.href, data.pageId);
                }
            }

            // Listen for favorites updates from meme page
            if (data.type === 'favoritesUpdated') {
                loadFavorites();
            }
        });

        // Forward sound:playDone events to iframe
        if (window.electronAPI && window.electronAPI.sound) {
            window.electronAPI.sound.onPlayDone(() => {
                if (contentFrame.contentWindow) {
                    contentFrame.contentWindow.postMessage({ type: 'sound:playDone' }, '*');
                }
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof window.electronAPI === 'undefined') {
                const navRight = document.querySelector('.nav-right');
                if (navRight) navRight.style.display = 'none';
            }

            loadPrefs();
            loadFavorites();

            // Video fallback - if video doesn't start in 3 seconds, skip it
            let videoStarted = false;
            introVideo.addEventListener('playing', () => { videoStarted = true; });
            setTimeout(() => {
                if (!videoStarted && dashboardView.style.display !== 'none') {
                    console.log('Video fallback triggered - skipping to default page');
                    showDefaultPage();
                }
            }, 3000);

            // Restore last page if exists
            const lastPage = localStorage.getItem(LAST_PAGE_KEY);
            if (lastPage) {
                try {
                    const { href, pageId } = JSON.parse(lastPage);
                    if (href) {
                        introVideo.pause();
                        introVideo.style.display = 'none';
                        const skipHint = document.querySelector('.skip-hint');
                        if (skipHint) skipHint.style.display = 'none';
                        dashboardView.style.display = 'none';
                        contentFrame.style.display = 'block';
                        loadingOverlay.classList.add('active');
                        contentFrame.src = href;
                        updateActiveButton(pageId);
                    }
                } catch (e) {
                    console.error('Failed to restore last page:', e);
                }
            }
        });
    </script>
</body>
</html>
